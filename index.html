<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalonTech Pro Invoice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --ea-navy: #13294b; --ea-gold: #C5B783; --ea-white: #FFFFFF; }
        body { background-color: var(--ea-navy); color: var(--ea-white); font-family: sans-serif; }
        .card { background-color: rgba(255, 255, 255, 0.05); border: 2px solid var(--ea-gold); }
        .accent-text { color: var(--ea-gold); }
        input, select { background-color: #1e3a5f !important; color: white !important; border: 1px solid #334155 !important; }
        .result-box { background-color: var(--ea-gold); color: var(--ea-navy); }
        .btn-submit { background-color: #10b981; transition: transform 0.1s; }
        .btn-submit:active { transform: scale(0.98); }
    </style>
</head>
<body class="p-4 flex flex-col items-center min-h-screen">

    <div id="app-card" class="max-w-md w-full card rounded-2xl shadow-2xl p-6 my-4">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-black accent-text uppercase tracking-wider">TalonTech Club</h1>
            <p class="text-sm font-bold opacity-90 mt-1 uppercase">Official Invoice System</p>
            <div class="h-1 w-24 bg-white mx-auto mt-2 rounded-full"></div>
        </header>

        <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-[10px] font-bold uppercase mb-1 accent-text">Student Name</label>
                    <input type="text" id="studentName" placeholder="Name" class="w-full p-2 rounded-lg outline-none text-sm">
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase mb-1 accent-text">Project Name</label>
                    <input type="text" id="projectName" placeholder="Project" class="w-full p-2 rounded-lg outline-none text-sm">
                </div>
            </div>

            <div>
                <label class="block text-[10px] font-bold uppercase mb-1 accent-text">1. Design Source</label>
                <select id="design" class="w-full p-2 rounded-lg outline-none text-sm" onchange="calc()">
                    <option value="1">Personal Design ($1)</option>
                    <option value="2">Online Design ($2)</option>
                    <option value="5.5">Club-Assisted/Modified ($5.50)</option>
                </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-[10px] font-bold uppercase mb-1 accent-text">2. Filament Type</label>
                    <select id="filamentType" class="w-full p-2 rounded-lg outline-none text-sm" onchange="calc()">
                        <option value="0.05">PLA</option>
                        <option value="0.075">PETG</option>
                        <option value="0.10">ABS</option>
                        <option value="0.125">TPU/Specialty</option>
                    </select>
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase mb-1 accent-text">Grams Used</label>
                    <input type="number" id="grams" placeholder="0" class="w-full p-2 rounded-lg outline-none text-sm" oninput="calc()">
                </div>
            </div>

            <div>
                <label class="block text-[10px] font-bold uppercase mb-1 accent-text">3. Print Time</label>
                <select id="time" class="w-full p-2 rounded-lg outline-none text-sm" onchange="calc()">
                    <option value="1">Under 1 hour ($1)</option>
                    <option value="3">1â€“3 hours ($3)</option>
                    <option value="6.5">3â€“6 hours ($6.50)</option>
                    <option value="10">6â€“12 hours ($10)</option>
                    <option value="15">12â€“24 hours ($15)</option>
                    <option value="25">Over 24 hours ($25)</option>
                </select>
            </div>

            <div>
                <label class="block text-[10px] font-bold uppercase mb-1 accent-text">4. Post-Processing & Labor</label>
                <select id="post" class="w-full p-2 rounded-lg outline-none text-sm" onchange="calc()">
                    <option value="0">None ($0)</option>
                    <option value="1.5">Light Support Removal ($1.50)</option>
                    <option value="4">Detailed Cleanup/Sanding ($4)</option>
                    <option value="6">Major/Heavy Support Removal ($6)</option>
                    <option value="10">Complex/Internal Support Release ($10)</option>
                    <option value="15">Full Assembly & Painting ($15)</option>
                </select>
            </div>
        </div>

        <div class="mt-6 p-4 result-box rounded-xl text-center shadow-lg">
            <p class="text-[10px] font-bold uppercase tracking-widest opacity-80">Suggested Donation</p>
            <h2 id="totalDisplay" class="text-4xl font-black mt-1">$3.00</h2>
        </div>

        <button onclick="submitInvoice()" class="w-full mt-4 py-3 rounded-xl text-sm font-bold uppercase tracking-widest btn-submit text-white shadow-lg">
            Submit & Download PDF
        </button>
    </div>

    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="if(submitted){showSuccess();}"></iframe>

    <script>
        let submitted = false;
        window.jsPDF = window.jspdf.jsPDF;

        function calc() {
            const d = parseFloat(document.getElementById('design').value);
            const fRate = parseFloat(document.getElementById('filamentType').value);
            const g = parseFloat(document.getElementById('grams').value) || 0;
            const t = parseFloat(document.getElementById('time').value);
            const p = parseFloat(document.getElementById('post').value);
            
            let total = d + (g * fRate) + t + p;
            if (total < 3) total = 3; 
            
            document.getElementById('totalDisplay').innerText = `$${total.toFixed(2)}`;
            return total.toFixed(2);
        }

        function submitInvoice() {
            const name = document.getElementById('studentName').value;
            const proj = document.getElementById('projectName').value;
            const fil = document.getElementById('filamentType').options[document.getElementById('filamentType').selectedIndex].text;
            const grams = document.getElementById('grams').value || "0";
            const time = document.getElementById('time').options[document.getElementById('time').selectedIndex].text;
            const post = document.getElementById('post').options[document.getElementById('post').selectedIndex].text;
            const design = document.getElementById('design').options[document.getElementById('design').selectedIndex].text;
            const total = calc();

            if(!name || !proj) { alert("Please enter Student and Project names."); return; }

            const formID = "1FAIpQLSekNv5fJmGCELXyxyHY4ImsaVjtcpg43m3n2T0wKDpg1LB7FQ";
            const baseURL = `https://docs.google.com/forms/d/e/${formID}/formResponse`;
            
            // Mapping to your exact entry IDs from the link provided
            const query = `?entry.1416729802=${encodeURIComponent(name)}` +
                          `&entry.465402565=${encodeURIComponent(proj)}` +
                          `&entry.2021312819=${encodeURIComponent(design)}` +
                          `&entry.58770648=${encodeURIComponent(total)}` +
                          `&entry.827172509=${encodeURIComponent(grams)}` +
                          `&entry.1195136044=${encodeURIComponent(fil)}` +
                          `&entry.1670091512=${encodeURIComponent(time)}` +
                          `&entry.654354275=${encodeURIComponent(post)}` +
                          `&submit=Submit`;

            submitted = true;
            document.getElementById('hidden_iframe').src = baseURL + query;
            generatePDF(name, proj, fil, grams, time, post, total);
        }

        function generatePDF(n, pr, f, g, t, po, tot) {
            const doc = new jsPDF();
            doc.setFillColor(19, 41, 75); doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255); doc.setFontSize(20); doc.text("TALONTECH CLUB INVOICE", 20, 25);
            doc.setTextColor(0, 0, 0); doc.setFontSize(12);
            doc.text(`Student: ${n}`, 20, 55); doc.text(`Project: ${pr}`, 20, 65);
            doc.line(20, 75, 190, 75);
            doc.text(`Filament: ${f} (${g}g)`, 20, 85);
            doc.text(`Print Time: ${t}`, 20, 95);
            doc.text(`Labor: ${po}`, 20, 105);
            doc.setFontSize(16); doc.text(`TOTAL SUGGESTED DONATION: $${tot}`, 20, 125);
            doc.save(`TalonTech_${n}.pdf`);
        }

        function showSuccess() {
            document.getElementById('app-card').innerHTML = `
                <div class="text-center py-10">
                    <div class="text-5xl mb-4">ðŸ¦…</div>
                    <h2 class="text-2xl font-black accent-text uppercase tracking-widest">Logged & Saved!</h2>
                    <p class="mt-2 text-sm text-slate-300 px-4">The invoice is in your downloads. Your print has been recorded in the club logs.</p>
                    <button onclick="location.reload()" class="mt-8 px-8 py-3 bg-blue-900 border-2 border-gold accent-text rounded-xl font-bold uppercase">Next Print</button>
                </div>`;
        }
    </script>
</body>
</html>
